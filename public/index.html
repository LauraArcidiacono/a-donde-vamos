<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#14B8A6">
  <meta name="description" content="Juego para 2 jugadores: descubrid juntos vuestro destino ideal de viaje.">
  <title>&iquest;A D&oacute;nde Vamos?</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="audio-styles.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
</head>
<body>

  <main id="app">

    <!-- ============================== -->
    <!-- 1. Lobby -->
    <!-- ============================== -->
    <section id="screen-lobby" class="screen active">
      <div class="screen-content lobby-content">
        <div class="lobby-header">
          <h1 class="app-title">&iquest;A D&oacute;nde Vamos?</h1>
          <p class="app-subtitle">Descubrid juntos vuestro destino ideal</p>
        </div>

        <div class="lobby-actions">
          <input type="text" id="input-name" class="name-input" placeholder="Tu nombre" maxlength="15" autocomplete="off">
          <button id="btn-create" class="btn btn-primary">Crear sala</button>

          <button id="btn-solo" class="btn btn-small btn-ghost">Modo prueba</button>

          <div class="divider">
            <span>&mdash; o &mdash;</span>
          </div>

          <div class="join-group">
            <label class="join-label" for="input-code">Unirse a sala</label>
            <div class="join-row">
              <input
                id="input-code"
                type="text"
                class="input-code"
                maxlength="4"
                placeholder="ABCD"
                autocomplete="off"
                autocapitalize="characters"
                spellcheck="false"
              >
              <button id="btn-join" class="btn btn-secondary">Entrar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 2. Waiting Room -->
    <!-- ============================== -->
    <section id="screen-waiting" class="screen">
      <div class="screen-content waiting-content">
        <h2 class="screen-heading">Tu sala est&aacute; lista</h2>

        <div class="room-code-box">
          <span class="room-code-label">C&oacute;digo de sala</span>
          <span id="room-code" class="room-code">----</span>
        </div>

        <div class="qr-wrapper hidden">
          <span class="qr-label">Escanea para unirte</span>
          <canvas id="qr-code"></canvas>
        </div>

        <div class="share-buttons">
          <button id="btn-share-whatsapp" class="btn btn-whatsapp btn-small">
            <span class="btn-icon">&#128172;</span>
            Enviar por WhatsApp
          </button>
          <button id="btn-share-link" class="btn btn-secondary btn-small">
            <svg class="btn-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/>
              <polyline points="16 6 12 2 8 6"/>
              <line x1="12" y1="2" x2="12" y2="15"/>
            </svg>
            Copiar link
          </button>
        </div>

        <div class="waiting-status-box">
          <span class="pulse-dot"></span>
          <span id="waiting-status">Esperando al otro jugador...</span>
        </div>

        <div id="player-count" class="player-count">1 / 2 jugadores</div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 2b. Game Intro / Onboarding -->
    <!-- ============================== -->
    <section id="screen-intro" class="screen">
      <div class="screen-content intro-content">
        <h2 class="screen-heading">&iquest;C&oacute;mo funciona?</h2>
        <p class="screen-subheading">3 rondas r&aacute;pidas para encontrar vuestro destino ideal</p>

        <div class="intro-rounds">
          <div class="intro-round">
            <span class="intro-round-icon">&#x1F9E0;</span>
            <div class="intro-round-info">
              <h4>Ronda 1 &mdash; Vibraciones</h4>
              <p>5 preguntas r&aacute;pidas sobre qu&eacute; os atrae: agua, monta&ntilde;a, gastronom&iacute;a...</p>
            </div>
          </div>
          <div class="intro-round">
            <span class="intro-round-icon">&#x2764;&#xFE0F;</span>
            <div class="intro-round-info">
              <h4>Ronda 2 &mdash; Prioridades</h4>
              <p>Elegid lo que m&aacute;s os importa y lo que NO quer&eacute;is en vuestro viaje.</p>
            </div>
          </div>
          <div class="intro-round">
            <span class="intro-round-icon">&#x2696;&#xFE0F;</span>
            <div class="intro-round-info">
              <h4>Ronda 3 &mdash; Ajuste fino</h4>
              <p>Deslizadores para afinar vuestras preferencias. Luego ver&eacute;is el resultado combinado.</p>
            </div>
          </div>
        </div>

        <button id="btn-intro-done" class="btn btn-primary">&iexcl;Entendido!</button>
        <div id="intro-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>Esperando al otro jugador...</span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 3. Ready Check -->
    <!-- ============================== -->
    <section id="screen-ready" class="screen">
      <div class="screen-content ready-content">
        <h2 class="screen-heading">&iexcl;Jugador conectado!</h2>
        <p class="screen-subheading">Preparados para empezar</p>

        <div class="ready-indicators">
          <div class="ready-player">
            <div id="p1-ready" class="ready-dot"></div>
            <span class="ready-player-label"><span id="p1-name">Jugador 1</span></span>
          </div>
          <div class="ready-player">
            <div id="p2-ready" class="ready-dot"></div>
            <span class="ready-player-label"><span id="p2-name">Jugador 2</span></span>
          </div>
        </div>

        <button id="btn-ready" class="btn btn-primary btn-pulse">&iexcl;Estoy listo!</button>

        <div id="countdown-overlay" class="countdown-overlay hidden">
          <span class="countdown-number"></span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 4. Instructions -->
    <!-- ============================== -->
    <section id="screen-instructions" class="screen">
      <div class="screen-content instructions-content">
        <div id="instr-icon" class="instr-icon"></div>
        <h2 id="instr-title" class="instr-title"></h2>
        <p id="instr-subtitle" class="instr-subtitle"></p>
        <ul id="instr-rules" class="instr-rules"></ul>
        <button id="btn-instr-next" class="btn btn-primary">Siguiente</button>
        <div id="instr-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>Esperando al otro jugador...</span>
        </div>
        <div class="instr-auto">Avanza autom&aacute;ticamente en <span id="instr-countdown">5</span>s</div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 5. Mini-Game 1: Emotional Test -->
    <!-- ============================== -->
    <section id="screen-mg1" class="screen">
      <div class="screen-content game-content">
        <div class="game-header">
          <span id="mg1-phase" class="phase-indicator">Ronda 1/3</span>
          <span id="mg1-counter" class="question-counter">Pregunta 1 de 5</span>
        </div>

        <div class="timer-container">
          <div id="mg1-timer-bar" class="timer-bar">
            <div class="timer-bar-fill" style="width: 100%"></div>
          </div>
          <div class="timer-row">
            <span id="mg1-timer" class="timer-number">20</span>
            <button id="mg1-extend" class="btn btn-small btn-ghost timer-extend">+10s</button>
          </div>
        </div>

        <h3 id="mg1-question" class="game-question"></h3>

        <div id="mg1-options" class="options-grid"></div>

        <p class="selection-hint">M&aacute;ximo 2</p>

        <button id="mg1-confirm" class="btn btn-primary" disabled>Confirmar</button>

        <div id="mg1-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>El otro jugador est&aacute; respondiendo...</span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 6. Mini-Game 2: Important -->
    <!-- ============================== -->
    <section id="screen-mg2-important" class="screen">
      <div class="screen-content game-content">
        <div class="game-header">
          <span class="phase-indicator">Ronda 2/3 &mdash; Muy Importante</span>
        </div>

        <div class="timer-container">
          <div id="mg2i-timer-bar" class="timer-bar">
            <div class="timer-bar-fill" style="width: 100%"></div>
          </div>
          <span id="mg2i-timer" class="timer-number">40</span>
        </div>

        <div class="search-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input id="mg2i-search" type="text" class="search-input" placeholder="Buscar...">
        </div>

        <p id="mg2i-count" class="selection-counter">0/3 seleccionadas</p>

        <div id="mg2i-options" class="options-grid scrollable"></div>

        <button id="mg2i-confirm" class="btn btn-primary" disabled>Confirmar</button>

        <div id="mg2i-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>El otro jugador est&aacute; eligiendo...</span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 7. Mini-Game 2: No Want -->
    <!-- ============================== -->
    <section id="screen-mg2-nowant" class="screen">
      <div class="screen-content game-content">
        <div class="game-header">
          <span class="phase-indicator">Ronda 2/3 &mdash; NO Quiero</span>
        </div>

        <div class="timer-container">
          <div id="mg2n-timer-bar" class="timer-bar">
            <div class="timer-bar-fill" style="width: 100%"></div>
          </div>
          <span id="mg2n-timer" class="timer-number">40</span>
        </div>

        <div class="search-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input id="mg2n-search" type="text" class="search-input" placeholder="Buscar...">
        </div>

        <p id="mg2n-count" class="selection-counter">0/3 seleccionadas</p>

        <div id="mg2n-options" class="options-grid scrollable"></div>

        <button id="mg2n-confirm" class="btn btn-primary" disabled>Confirmar</button>

        <div id="mg2n-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>El otro jugador est&aacute; eligiendo...</span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 8. Mini-Game 3: Sliders -->
    <!-- ============================== -->
    <section id="screen-mg3" class="screen">
      <div class="screen-content game-content">
        <div class="game-header">
          <span class="phase-indicator">Ronda 3/3 &mdash; Prioridades</span>
        </div>

        <div class="timer-container">
          <div id="mg3-timer-bar" class="timer-bar">
            <div class="timer-bar-fill" style="width: 100%"></div>
          </div>
          <span id="mg3-timer" class="timer-number">40</span>
        </div>

        <div id="mg3-sliders" class="sliders-container"></div>

        <button id="mg3-confirm" class="btn btn-primary">Confirmar</button>

        <div id="mg3-partner-status" class="partner-status hidden">
          <span class="pulse-dot"></span>
          <span>El otro jugador est&aacute; ajustando...</span>
        </div>
      </div>
    </section>

    <!-- ============================== -->
    <!-- 9. Results -->
    <!-- ============================== -->
    <section id="screen-results" class="screen">
      <div class="screen-content results-content">
        <h2 class="results-title">&iexcl;Resultados!</h2>

        <div id="results-tabs" class="results-tabs">
          <button class="tab active" data-tab="p1">Tu top</button>
          <button class="tab" data-tab="p2">Su top</button>
          <button class="tab" data-tab="combined">Combinado</button>
        </div>

        <div id="results-p1" class="results-panel active">
          <!-- City cards rendered by JS -->
        </div>

        <div id="results-p2" class="results-panel">
          <!-- City cards rendered by JS -->
        </div>

        <div id="results-combined" class="results-panel">
          <!-- City cards rendered by JS -->
        </div>

        <div id="results-coincidences" class="results-coincidences">
          <!-- Coincidence badges rendered by JS -->
        </div>

        <details id="results-penalties" class="results-penalties">
          <summary>Ajustes por tus &laquo;no quiero&raquo;</summary>
          <div class="penalties-content">
            <!-- Penalty details rendered by JS -->
          </div>
        </details>

        <div class="results-actions">
          <button id="btn-rematch" class="btn btn-primary">Revancha</button>
          <button id="btn-share-results" class="btn btn-secondary btn-small">
            <svg class="btn-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/>
              <polyline points="16 6 12 2 8 6"/>
              <line x1="12" y1="2" x2="12" y2="15"/>
            </svg>
            Compartir resultado
          </button>
        </div>
      </div>
    </section>

  </main>

  <!-- ============================== -->
  <!-- 10. Disconnection overlay -->
  <!-- ============================== -->
  <div id="overlay-disconnect" class="overlay hidden">
    <div class="overlay-card">
      <div class="overlay-icon">&#9888;&#65039;</div>
      <h3>Conexi&oacute;n perdida</h3>
      <p>El otro jugador se ha desconectado</p>
      <div class="overlay-status">
        <span class="pulse-dot"></span>
        <span>Esperando reconexi&oacute;n...</span>
      </div>
      <span id="disconnect-countdown" class="disconnect-countdown">30</span>
    </div>
  </div>

  <!-- ============================== -->
  <!-- 11. Connection error overlay -->
  <!-- ============================== -->
  <div id="overlay-error" class="overlay hidden">
    <div class="overlay-card">
      <div class="overlay-icon">&#10060;</div>
      <p id="error-message" class="error-message">Ha ocurrido un error</p>
      <button id="btn-back-lobby" class="btn btn-primary">Volver al inicio</button>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
